___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "PrivacyPillar Consent Manager - CMP",
  "categories": [
    "PERSONALIZATION",
    "TAG_MANAGEMENT"
  ],
  "brand": {
    "id": "privacypillar",
    "displayName": "PrivacyPillar",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAMAAABHPGVmAAAAAXNSR0IB2cksfwAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAqZQTFRFBAVICAlLCwxNCgtMBgdJBQZIBQZJCgtNDA1OBwhKRUV2trfH3+Dk7e3t7Ozt5+fp4ODl3t7j19fe1tbe0NHZzs7Yzs7XwsLPwMDNyMjT1NTc3d3i39/k5ubp6enr7+/v7u7v6Ojq29vhycnUs7TFnZ21eXmbVFSBLzBmFBVThoakoqO4XF2GFxhWcnKW5+fqq6u/OztvCQpLICFc2trg6urrpKS6mJmxmJixl5ixkZKsoKG3xMTRp6e8IiJdbW2Sc3OXDxBQJCVe4ODktbXFERJRS0x75OTnfHydlpewGxxZQEFzu7vK7u7un5+2FhdVm5uznJ21d3iaz8/YHyBbeXqcYGGKvLzLGBlWLC1l4+PmLC1kGBhWa2yS6+vstbXGkZGsqqq+BgdKFRZU2dngnp61YmOLrK2/7e3ura7A4eHlKSpiEBFR2drggoKijo6qlJSuJSZfNjdsIyReGhtYCQpMtLXFY2SMZ2iPvb3LCgpMNDVqIiNdFxhVTE17dneZ2dnfmpqzEBFQzc7X09Pbzc3Xrq/B1dXdrq7An6C2hYWjHh9bV1iDPT5xLi9mfX2excXRv7/NPD1w6enqHB1ZqKi8nZ61Rkd3WlqFi4uoJidgvb3MmpuzDg9PUVJ/i4yo5OXoYmKLHR5aGRpXJyhhra3An6C3cXGV39/j4+PntLTFTEx7EhNS1tbddXaYz8/Zf3+fLS5ls7PEOTltNTZreHmbe3yciYmnjIypgICgdXWYYmKKR0d4MDFo3NzhISJd5eXowcHOxMTQysrULzBn0tLaOjtvOzxv6ursxsfS0dHaysrVx8jTZWaOSUp6P0ByODhtGxxYLCxkMjNpR0d3SUp5ExRTEBBQqaq+0NDZ4uLm3N3iy8vWycnVx8fTvL3LxsbSCQlLo6r7kAAAA2hJREFUeJzt2fdb00AYB/BLU0uDkiqKo4XGoqKooLZWwY2ouOpAlLYquEVw71H3nqDiwr0XdQ9cuPfEver4TyxWefJiSdKr10d88v3xrnef50bvuSQIyZEjR05AQikUNEUplRV4ZSolRdF0kFqtpmmaYpR+CsEVK4WwmspVQqtWCwurXqNmcWqFaUN14REaPcfVNmg04ZHaOnXrRdVvEK3CMpQNDZzkRGgbNY6pIN5pqahipROeNGnazOgjYmrO78BcG/Sna9EyLr5V6zYayGjatvMNac9r3CGhYyLordOv0Xbu0hbOaVJX2hekG69pvKp7uDfEHapHT1Bj6dXbB6QPr2VfZZkIQsZkOGn9UqQj/XntopAAgpgBLKhMtUpGbPaSVuxANCiybAShwWmgNl3yJmOGlDQaOgwNHyGE0CPhuoySPBT16AxPmzHupRRGkDUTVOuyJCtjY8e5/x3jxo9FogiaAKq5iZIR9zRMmpzl2fdiyBQ4FMNUH5SSiCHTpsOhzCCBoJkQmTWbBDIHIokOEshcPfiBZR4JRAGPBG4+DrJABEGhEFmIgSzSiiGLITIUA0lYIoYshcgyIshyiKwggTDwmOZWkkAS7BBZRQJZnQGRNSSQtdCIWEcCyYZIjpoAolgPkWQMQxTZAI+ujbkkkE1wIJuxrt8iyJYQUK014RgiiAmeKRlbsQxhJLeUsQ3vWUUQydsOF2THTjxDADHughcV824K0ygTUU1pDTfvnr2+PggJITF5+/Yf2HXQDMrTDk3CJrwhh+1HdEctoNRy7Dj2VBUn31kaOQFXm9OfPHUac1f9zp8XCT7CRp7JPpvvn4C8XYnOnb9wsaCg4NLlK1evxQT5DXhHCERGZIQcYi0MACL0RkJG/mMkBT4ZpBNBrt8AyM1AILfKL9IuEIhNEwBknSHwyG0iyB2I3CWC3DMHALn/oLwjTNzDn3kEP22YPaUPc4L/BkI95gQzs/wgT4q7srCsHsTMsp4XNk//BoJsz56/sGU5HFOt/BQ5HHkvX917/eatn92/i3ZnrkkovaM9YXCNfQvS3GFDhMKmedIHF3FkCq44yPt/Gin6EGH/qPsU6nR+drlcX76m8vL1m7vItdTpdBZ+SrQnNfHlcwnMdzVNM2JLyjBGWqH28yOzHDly5ODlB/VQuRkrJ7yMAAAAAElFTkSuQmCC"
  },
  "description": "PrivacyPillar consent management for the ePrivacy, GDPR and CCPA.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "pid",
    "displayName": "Property ID",
    "simpleValueType": true,
    "valueHint": "fa1903a4-ebd0-43bb-b772-7f4c3242e292",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "oid",
    "displayName": "Organisation ID",
    "simpleValueType": true,
    "valueHint": "39d8face-ec86-49a0-a3d7-39170528ec18",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
const setDefaultConsentState = require('setDefaultConsentState');
const encodeUri = require('encodeUri');
const updateConsentState = require('updateConsentState');
const log = require('logToConsole');
const getCookieValues = require('getCookieValues');
const JSON = require('JSON');
const callInWindow = require('callInWindow');
const gtagSet = require('gtagSet'); 
const callLater = require('callLater');
const COOKIE_NAME = 'privacypillar-cookie-consent';

gtagSet('developer_id.dMDQzYW', true);

// Set Default Consent
setDefaultConsentState({
  'functionality_storage': 'denied',
  'personalization_storage': 'denied',
  'analytics_storage': 'denied',
  'security_storage': 'granted',
  'ad_storage': 'denied',
  'ad_user_data': 'denied',
  'ad_personalization': 'denied',
  'wait_for_update': 500
});

// Update user consent
const onUpdateConsent = (consent) => {
    updateConsentState({
      'functionality_storage': consent.functional ? 'granted' : 'denied',
      'personalization_storage': consent.functional ? 'granted' : 'denied',
      'analytics_storage': consent.analytics ? 'granted' : 'denied',
      'security_storage': 'granted',
      'ad_storage': consent.advertising ? 'granted' : 'denied',
      'ad_user_data': consent.advertising ? 'granted' : 'denied',
     'ad_personalization': consent.advertising ? 'granted' : 'denied',
     });
};

// Read existing consent if it exists
const checkExistingCookie =()=>{
  const consentString = getCookieValues("privacypillar-cookie-consent");
if (consentString.toString() !== '') {
  const consent =  JSON.parse(consentString);
  if (typeof consent !== 'undefined') {
    const purpose = consent.purpose;
    onUpdateConsent(purpose);
  }
}
};

callLater(checkExistingCookie);


// Load Banner
let scriptURL = encodeUri('https://cdn.primeconsent.com/cmp/v2.2/web/' + data.oid +'/' +  data.pid +'-bundle.js');
if (!queryPermission('inject_script', scriptURL)) {
   return data.gtmOnFailure();
}

const onSuccess = () => {
      data.gtmOnSuccess();
      return;
};

injectScript(scriptURL, onSuccess, data.gtmOnFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.primeconsent.com/cmp/v2.2/web/*/*-bundle.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wait_for_update"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "privacypillar-cookie-consent"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "developer_id.dMDQzYW"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 09/10/2024, 17:01:13


